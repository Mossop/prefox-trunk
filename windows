# HG changeset patch
# User Dave Townsend <dtownsend@oxymoronical.com>
# Date 1278907787 25200
# Node ID 1e5428438fd655587be3275fd5943861361810da
# Parent dc43d6a21b26533c0d32bb208b4a8c87f6890769
[palm] First stages of making build work on windows

diff --git a/configure.in b/configure.in
--- a/configure.in
+++ b/configure.in
@@ -355,6 +355,11 @@ AC_ARG_WITH(palm-sdk,
            location where the Palm SDK can be found],
     palm_sdk=$withval)
 
+AC_ARG_WITH(palm-toolchain,
+    [  --with-palm-toolchain=DIR
+           location of the palm toolchain, default PDK/arm-gcc],
+    palm_toolchain=$withval)
+
 if test "$target" = "arm-palm-eabi" ; then
     if test -z "$palm_pdk" ; then
         palm_pdk=/opt/PalmPDK
@@ -371,15 +376,19 @@ if test "$target" = "arm-palm-eabi" ; th
         AC_MSG_ERROR([You must specify the path to the Palm SDK with --with-palm-sdk=/path/to/sdk when targeting Palm.])
     fi
 
+    if test -z "$palm_toolchain" ; then
+       palm_toolchain="$palm_pdk/arm_gcc"
+    fi
+
     dnl set up compilers
-    AS="$palm_pdk"/arm-gcc/bin/arm-none-linux-gnueabi-as
-    CC="$palm_pdk"/arm-gcc/bin/arm-none-linux-gnueabi-gcc
-    CXX="$palm_pdk"/arm-gcc/bin/arm-none-linux-gnueabi-g++
-    CPP="$palm_pdk"/arm-gcc/bin/arm-none-linux-gnueabi-cpp
-    LD="$palm_pdk"/arm-gcc/bin/arm-none-linux-gnueabi-ld
-    AR="$palm_pdk"/arm-gcc/bin/arm-none-linux-gnueabi-ar
-    RANLIB="$palm_pdk"/arm-gcc/bin/arm-none-linux-gnueabi-ranlib
-    STRIP="$palm_pdk"/arm-gcc/bin/arm-none-linux-gnueabi-strip
+    AS="$palm_toolchain/bin/arm-none-linux-gnueabi-as"
+    CC="$palm_toolchain/bin/arm-none-linux-gnueabi-gcc"
+    CXX="$palm_toolchain/bin/arm-none-linux-gnueabi-g++"
+    CPP="$palm_toolchain/bin/arm-none-linux-gnueabi-cpp"
+    LD="$palm_toolchain/bin/arm-none-linux-gnueabi-ld"
+    AR="$palm_toolchain/bin/arm-none-linux-gnueabi-ar"
+    RANLIB="$palm_toolchain/bin/arm-none-linux-gnueabi-ranlib"
+    STRIP="$palm_toolchain/bin/arm-none-linux-gnueabi-strip"
 
     dnl set up the various flags, but only if they're not specified earlier
     palm_flags="-I$palm_pdk/include -DWEBOS -mfloat-abi=softfp -fno-short-enums -fno-exceptions"
@@ -398,12 +407,14 @@ if test "$target" = "arm-palm-eabi" ; th
     fi
 
     if test -z "$LDFLAGS" ; then
-        LDFLAGS="-L$palm_pdk/device/lib"
-        LDFLAGS="$LDFLAGS --sysroot=$palm_pdk/arm-gcc/sysroot"
-        dnl Add --allow-shlib-undefined, because libGLESv2 links to an
-        dnl undefined symbol (present on the hardware, just not in the
-        dnl NDK.)
-        LDFLAGS="$LDFLAGS -Wl,--allow-shlib-undefined"
+        LDFLAGS="-L$palm_pdk/device/lib -Wl,--allow-shlib-undefined"
+        case "$host" in
+        *-cygwin*|*-mingw*|*-msvc*|*-mks*)
+            ;;
+        *)
+            LDFLAGS+=" --sysroot=$palm_toolchain/sysroot"
+            ;;
+        esac
     fi
 
     dnl Make sure the host flags don't default to the target flags
diff --git a/js/src/configure.in b/js/src/configure.in
--- a/js/src/configure.in
+++ b/js/src/configure.in
@@ -286,20 +286,29 @@ AC_ARG_WITH(palm-pdk,
            location where the Palm PDK can be found],
     palm_pdk=$withval)
 
+AC_ARG_WITH(palm-toolchain,
+    [  --with-palm-toolchain=DIR
+           location of the palm toolchain, default PDK/arm-gcc],
+    palm_toolchain=$withval)
+
 if test "$target" = "arm-palm-eabi" ; then
     if test -z "$palm_pdk" ; then
        AC_MSG_ERROR([Palm target, but missing --with-palm-pdk option!])
     fi
 
+    if test -z "$palm_toolchain" ; then
+       palm_toolchain="$palm_pdk/arm_gcc"
+    fi
+
     dnl set up compilers
-    AS="$palm_pdk"/arm-gcc/bin/arm-none-linux-gnueabi-as
-    CC="$palm_pdk"/arm-gcc/bin/arm-none-linux-gnueabi-gcc
-    CXX="$palm_pdk"/arm-gcc/bin/arm-none-linux-gnueabi-g++
-    CPP="$palm_pdk"/arm-gcc/bin/arm-none-linux-gnueabi-cpp
-    LD="$palm_pdk"/arm-gcc/bin/arm-none-linux-gnueabi-ld
-    AR="$palm_pdk"/arm-gcc/bin/arm-none-linux-gnueabi-ar
-    RANLIB="$palm_pdk"/arm-gcc/bin/arm-none-linux-gnueabi-ranlib
-    STRIP="$palm_pdk"/arm-gcc/bin/arm-none-linux-gnueabi-strip
+    AS="$palm_toolchain/bin/arm-none-linux-gnueabi-as"
+    CC="$palm_toolchain/bin/arm-none-linux-gnueabi-gcc"
+    CXX="$palm_toolchain/bin/arm-none-linux-gnueabi-g++"
+    CPP="$palm_toolchain/bin/arm-none-linux-gnueabi-cpp"
+    LD="$palm_toolchain/bin/arm-none-linux-gnueabi-ld"
+    AR="$palm_toolchain/bin/arm-none-linux-gnueabi-ar"
+    RANLIB="$palm_toolchain/bin/arm-none-linux-gnueabi-ranlib"
+    STRIP="$palm_toolchain/bin/arm-none-linux-gnueabi-strip"
 
     dnl set up the various flags
     palm_flags="-I$palm_pdk/include -mfloat-abi=softfp -fno-short-enums -fno-exceptions"
@@ -308,7 +317,14 @@ if test "$target" = "arm-palm-eabi" ; th
     CPPFLAGS="$palm_flags $CPPFLAGS"
     CFLAGS="$palm_flags $CFLAGS"
     CXXFLAGS="$palm_flags $CXXFLAGS"
-    LDFLAGS="-L$palm_pdk/device/lib --sysroot=$palm_pdk/arm-gcc/sysroot -Wl,--allow-shlib-undefined $LDFLAGS"
+    LDFLAGS="-L$palm_pdk/device/lib -Wl,--allow-shlib-undefined $LDFLAGS"
+    case "$host" in
+    *-cygwin*|*-mingw*|*-msvc*|*-mks*)
+        ;;
+    *)
+        LDFLAGS+=" --sysroot=$palm_toolchain/sysroot"
+        ;;
+    esac
 
     dnl Make sure the host flags don't default to the target flags
     if test -z "$HOST_CPPFLAGS"; then
diff --git a/nsprpub/configure.in b/nsprpub/configure.in
--- a/nsprpub/configure.in
+++ b/nsprpub/configure.in
@@ -206,20 +206,29 @@ AC_ARG_WITH(palm-pdk,
            location where the Palm PDK can be found],
     palm_pdk=$withval)
 
+AC_ARG_WITH(palm-toolchain,
+    [  --with-palm-toolchain=DIR
+           location of the palm toolchain, default PDK/arm-gcc],
+    palm_toolchain=$withval)
+
 if test "$target" = "arm-palm-eabi" ; then
     if test -z "$palm_pdk" ; then
        AC_MSG_ERROR([Palm target, but missing --with-palm-pdk option!])
     fi
 
+    if test -z "$palm_toolchain" ; then
+       palm_toolchain="$palm_pdk/arm_gcc"
+    fi
+
     dnl set up compilers
-    AS="$palm_pdk"/arm-gcc/bin/arm-none-linux-gnueabi-as
-    CC="$palm_pdk"/arm-gcc/bin/arm-none-linux-gnueabi-gcc
-    CXX="$palm_pdk"/arm-gcc/bin/arm-none-linux-gnueabi-g++
-    CPP="$palm_pdk"/arm-gcc/bin/arm-none-linux-gnueabi-cpp
-    LD="$palm_pdk"/arm-gcc/bin/arm-none-linux-gnueabi-ld
-    AR="$palm_pdk"/arm-gcc/bin/arm-none-linux-gnueabi-ar
-    RANLIB="$palm_pdk"/arm-gcc/bin/arm-none-linux-gnueabi-ranlib
-    STRIP="$palm_pdk"/arm-gcc/bin/arm-none-linux-gnueabi-strip
+    AS="$palm_toolchain/bin/arm-none-linux-gnueabi-as"
+    CC="$palm_toolchain/bin/arm-none-linux-gnueabi-gcc"
+    CXX="$palm_toolchain/bin/arm-none-linux-gnueabi-g++"
+    CPP="$palm_toolchain/bin/arm-none-linux-gnueabi-cpp"
+    LD="$palm_toolchain/bin/arm-none-linux-gnueabi-ld"
+    AR="$palm_toolchain/bin/arm-none-linux-gnueabi-ar"
+    RANLIB="$palm_toolchain/bin/arm-none-linux-gnueabi-ranlib"
+    STRIP="$palm_toolchain/bin/arm-none-linux-gnueabi-strip"
 
     dnl set up the various flags
     palm_flags="-I$palm_pdk/include -mfloat-abi=softfp -fno-short-enums -fno-exceptions"
@@ -228,7 +237,14 @@ if test "$target" = "arm-palm-eabi" ; th
     CPPFLAGS="$palm_flags $CPPFLAGS"
     CFLAGS="$palm_flags $CFLAGS"
     CXXFLAGS="$palm_flags $CXXFLAGS"
-    LDFLAGS="-L$palm_pdk/device/lib --sysroot=$palm_pdk/arm-gcc/sysroot -Wl,--allow-shlib-undefined $LDFLAGS"
+    LDFLAGS="-L$palm_pdk/device/lib -Wl,--allow-shlib-undefined $LDFLAGS"
+    case "$host" in
+    *-cygwin*|*-mingw*|*-msvc*|*-mks*)
+        ;;
+    *)
+        LDFLAGS+=" --sysroot=$palm_toolchain/sysroot"
+        ;;
+    esac
 
     dnl Make sure the host flags don't default to the target flags
     if test -z "$HOST_CPPFLAGS"; then
