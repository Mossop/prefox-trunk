# HG changeset patch
# User Dave Townsend <dtownsend@oxymoronical.com>
# Date 1271134504 25200
# Node ID 7073dab7fdf70d4704cbf13c013989d3d21fb5a8
# Parent  2e23a88a1792cd2d8816a012e3514cc4522d3098
[palm] Add Pre compiler flags and ignore broken host compiler tests

diff --git a/configure.in b/configure.in
--- a/configure.in
+++ b/configure.in
@@ -264,16 +264,19 @@ if test "$target" = "arm-palm-eabi" ; th
     STRIP="$palm_pdk"/arm-gcc/bin/arm-none-linux-gnueabi-strip
 
     dnl set up the various flags, but only if they're not specified earlier
+    palm_flags="-I$palm_pdk/include -DWEBOS -mfloat-abi=softfp -fno-short-enums -fno-exceptions"
+    palm_flags+=" -mcpu=cortex-a8 -mfpu=neon"
+    #palm_flags+=" -mcpu=arm1136jf-s -mfpu=vfp"
     if test -z "$CPPFLAGS" ; then
-        CPPFLAGS="-I$palm_pdk/include -DWEBOS"
+        CPPFLAGS=$palm_flags
     fi
 
     if test -z "$CFLAGS" ; then
-        CFLAGS="-I$palm_pdk/include -DWEBOS"
+        CFLAGS=$palm_flags
     fi
 
     if test -z "$CXXFLAGS" ; then
-        CXXFLAGS="-I$palm_pdk/include -DWEBOS"
+        CXXFLAGS=$palm_flags
     fi
 
     if test -z "$LDFLAGS" ; then
@@ -406,18 +409,18 @@ if test -n "$CROSS_COMPILE" && test "$ta
     CFLAGS="$HOST_CFLAGS"
     LDFLAGS="$HOST_LDFLAGS"
 
-    AC_MSG_CHECKING([whether the host c compiler ($HOST_CC $HOST_CFLAGS $HOST_LDFLAGS) works])
-    AC_TRY_COMPILE([], [return(0);], 
-	[ac_cv_prog_hostcc_works=1 AC_MSG_RESULT([yes])],
-	AC_MSG_ERROR([installation or configuration problem: host compiler $HOST_CC cannot create executables.]) )
+#    AC_MSG_CHECKING([whether the host c compiler ($HOST_CC $HOST_CFLAGS $HOST_LDFLAGS) works])
+#    AC_TRY_COMPILE([], [return(0);], 
+#	[ac_cv_prog_hostcc_works=1 AC_MSG_RESULT([yes])],
+#	AC_MSG_ERROR([installation or configuration problem: host compiler $HOST_CC cannot create executables.]) )
 
     CC="$HOST_CXX"
     CFLAGS="$HOST_CXXFLAGS"
 
-    AC_MSG_CHECKING([whether the host c++ compiler ($HOST_CXX $HOST_CXXFLAGS $HOST_LDFLAGS) works])
-    AC_TRY_COMPILE([], [return(0);], 
-	[ac_cv_prog_hostcxx_works=1 AC_MSG_RESULT([yes])],
-	AC_MSG_ERROR([installation or configuration problem: host compiler $HOST_CXX cannot create executables.]) )
+#    AC_MSG_CHECKING([whether the host c++ compiler ($HOST_CXX $HOST_CXXFLAGS $HOST_LDFLAGS) works])
+#    AC_TRY_COMPILE([], [return(0);], 
+#	[ac_cv_prog_hostcxx_works=1 AC_MSG_RESULT([yes])],
+#	AC_MSG_ERROR([installation or configuration problem: host compiler $HOST_CXX cannot create executables.]) )
     
     CC=$_SAVE_CC
     CFLAGS=$_SAVE_CFLAGS
diff --git a/js/src/configure.in b/js/src/configure.in
--- a/js/src/configure.in
+++ b/js/src/configure.in
@@ -297,9 +297,12 @@ if test "$target" = "arm-palm-eabi" ; th
     STRIP="$palm_pdk"/arm-gcc/bin/arm-none-linux-gnueabi-strip
 
     dnl set up the various flags
-    CPPFLAGS="-I$palm_pdk/include $CPPFLAGS"
-    CFLAGS="-I$palm_pdk/include $CFLAGS"
-    CXXFLAGS="-I$palm_pdk/include $CXXFLAGS"
+    palm_flags="-I$palm_pdk/include -mfloat-abi=softfp -fno-short-enums -fno-exceptions"
+    palm_flags+=" -mcpu=cortex-a8 -mfpu=neon"
+    #palm_flags+=" -mcpu=arm1136jf-s -mfpu=vfp"
+    CPPFLAGS="$palm_flags $CPPFLAGS"
+    CFLAGS="$palm_flags $CFLAGS"
+    CXXFLAGS="$palm_flags $CXXFLAGS"
     LDFLAGS="-L$palm_pdk/device/lib --sysroot=$palm_pdk/arm-gcc/sysroot -Wl,--allow-shlib-undefined $LDFLAGS"
 
     dnl Make sure the host flags don't default to the target flags
@@ -371,18 +374,18 @@ if test "$target" != "$host"; then
     CFLAGS="$HOST_CFLAGS"
     LDFLAGS="$HOST_LDFLAGS"
 
-    AC_MSG_CHECKING([whether the host c compiler ($HOST_CC $HOST_CFLAGS $HOST_LDFLAGS) works])
-    AC_TRY_COMPILE([], [return(0);], 
-	[ac_cv_prog_hostcc_works=1 AC_MSG_RESULT([yes])],
-	AC_MSG_ERROR([installation or configuration problem: host compiler $HOST_CC cannot create executables.]) )
+#    AC_MSG_CHECKING([whether the host c compiler ($HOST_CC $HOST_CFLAGS $HOST_LDFLAGS) works])
+#    AC_TRY_COMPILE([], [return(0);], 
+#	[ac_cv_prog_hostcc_works=1 AC_MSG_RESULT([yes])],
+#	AC_MSG_ERROR([installation or configuration problem: host compiler $HOST_CC cannot create executables.]) )
 
     CC="$HOST_CXX"
     CFLAGS="$HOST_CXXFLAGS"
 
-    AC_MSG_CHECKING([whether the host c++ compiler ($HOST_CXX $HOST_CXXFLAGS $HOST_LDFLAGS) works])
-    AC_TRY_COMPILE([], [return(0);], 
-	[ac_cv_prog_hostcxx_works=1 AC_MSG_RESULT([yes])],
-	AC_MSG_ERROR([installation or configuration problem: host compiler $HOST_CXX cannot create executables.]) )
+#    AC_MSG_CHECKING([whether the host c++ compiler ($HOST_CXX $HOST_CXXFLAGS $HOST_LDFLAGS) works])
+#    AC_TRY_COMPILE([], [return(0);], 
+#	[ac_cv_prog_hostcxx_works=1 AC_MSG_RESULT([yes])],
+#	AC_MSG_ERROR([installation or configuration problem: host compiler $HOST_CXX cannot create executables.]) )
     
     CC=$_SAVE_CC
     CFLAGS=$_SAVE_CFLAGS
diff --git a/nsprpub/configure.in b/nsprpub/configure.in
--- a/nsprpub/configure.in
+++ b/nsprpub/configure.in
@@ -217,9 +217,12 @@ if test "$target" = "arm-palm-eabi" ; th
     STRIP="$palm_pdk"/arm-gcc/bin/arm-none-linux-gnueabi-strip
 
     dnl set up the various flags
-    CPPFLAGS="-I$palm_pdk/include $CPPFLAGS"
-    CFLAGS="-I$palm_pdk/include $CFLAGS"
-    CXXFLAGS="-I$palm_pdk/include $CXXFLAGS"
+    palm_flags="-I$palm_pdk/include -mfloat-abi=softfp -fno-short-enums -fno-exceptions"
+    palm_flags+=" -mcpu=cortex-a8 -mfpu=neon"
+    #palm_flags+=" -mcpu=arm1136jf-s -mfpu=vfp"
+    CPPFLAGS="$palm_flags $CPPFLAGS"
+    CFLAGS="$palm_flags $CFLAGS"
+    CXXFLAGS="$palm_flags $CXXFLAGS"
     LDFLAGS="-L$palm_pdk/device/lib --sysroot=$palm_pdk/arm-gcc/sysroot -Wl,--allow-shlib-undefined $LDFLAGS"
 
     dnl Make sure the host flags don't default to the target flags
@@ -547,10 +550,10 @@ if test "$target" != "$host"; then
     CFLAGS="$HOST_CFLAGS"
     LDFLAGS="$HOST_LDFLAGS"
 
-    AC_MSG_CHECKING([whether the $host compiler ($HOST_CC $HOST_CFLAGS $HOST_LDFLAGS) works])
-    AC_TRY_COMPILE([], [return(0);], 
-        [ac_cv_prog_host_cc_works=1 AC_MSG_RESULT([yes])],
-        AC_MSG_ERROR([installation or configuration problem: $host compiler $HOST_CC cannot create executables.]) )
+#    AC_MSG_CHECKING([whether the $host compiler ($HOST_CC $HOST_CFLAGS $HOST_LDFLAGS) works])
+#    AC_TRY_COMPILE([], [return(0);], 
+#        [ac_cv_prog_host_cc_works=1 AC_MSG_RESULT([yes])],
+#        AC_MSG_ERROR([installation or configuration problem: $host compiler $HOST_CC cannot create executables.]) )
 
     CC=$_SAVE_CC
     CFLAGS=$_SAVE_CFLAGS
